From bd5d5176c74021e8cf4970f93f273ba3023c3d72 Mon Sep 17 00:00:00 2001
From: Jason Monk <jmonk@google.com>
Date: Thu, 30 Jun 2016 11:26:08 -0400
Subject: [PATCH] Pre-setup restrictions

 - Don't let user settings run

Bug: 29194585
Change-Id: Ia9c46c7ba04ce2809304bebe8a4c5cdac2108611
---
 src/com/android/settings/users/UserSettings.java | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/com/android/settings/users/UserSettings.java b/src/com/android/settings/users/UserSettings.java
index d6b189b..02fd677 100644
--- a/src/com/android/settings/users/UserSettings.java
+++ b/src/com/android/settings/users/UserSettings.java
@@ -44,6 +44,7 @@ import android.support.v7.preference.Preference;
 import android.support.v7.preference.Preference.OnPreferenceClickListener;
 import android.support.v7.preference.PreferenceGroup;
 import android.support.v7.preference.PreferenceScreen;
+import android.provider.Settings.Global;
 import android.util.Log;
 import android.util.SparseArray;
 import android.view.Menu;
@@ -241,6 +242,11 @@ public class UserSettings extends SettingsPreferenceFragment
         loadProfile();
         updateUserList();
         mShouldUpdateUserList = false;
+
+        if (Global.getInt(getContext().getContentResolver(), Global.DEVICE_PROVISIONED, 0) == 0) {
+            getActivity().finish();
+            return;
+        }
     }
 
     @Override
-- 
2.9.3


From c372cb67ade0e6b73f00d78abafe6c800f5a9bf2 Mon Sep 17 00:00:00 2001
From: Sudheer Shanka <sudheersai@google.com>
Date: Fri, 29 Jul 2016 11:03:37 -0700
Subject: [PATCH 7/7] Allow apps with CREATE_USERS permission to call
 UM.getProfiles.

Bug: 29189712
Bug: 30317026
Bug: 30235113
Change-Id: I899f13898773483ee627a974d70173b5aa962e9a
---
 services/core/java/com/android/server/pm/UserManagerService.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/pm/UserManagerService.java b/services/core/java/com/android/server/pm/UserManagerService.java
index d8a1c77..632a98e 100644
--- a/services/core/java/com/android/server/pm/UserManagerService.java
+++ b/services/core/java/com/android/server/pm/UserManagerService.java
@@ -548,7 +548,7 @@ public class UserManagerService extends IUserManager.Stub {
     public List<UserInfo> getProfiles(int userId, boolean enabledOnly) {
         boolean returnFullInfo = true;
         if (userId != UserHandle.getCallingUserId()) {
-            checkManageUsersPermission("getting profiles related to user " + userId);
+            checkManageOrCreateUsersPermission("getting profiles related to user " + userId);
         } else {
             returnFullInfo = hasManageUsersPermission();
         }
-- 
2.9.3

